{"entities":{"User":{"$schema":"http://json-schema.org/draft-07/schema#","title":"User","type":"object","description":"Represents a user of the Sentinel Scan application.","properties":{"id":{"type":"string","description":"Unique identifier for the User entity."},"phoneNumber":{"type":"string","description":"User's phone number for authentication.","format":"string"},"isPro":{"type":"boolean","description":"Indicates whether the user has a pro subscription."}},"required":["id","phoneNumber"]},"ScanHistory":{"$schema":"http://json-schema.org/draft-07/schema#","title":"ScanHistory","type":"object","description":"Represents a record of a scanned link.","properties":{"id":{"type":"string","description":"Unique identifier for the ScanHistory entity."},"userId":{"type":"string","description":"Reference to User. (Relationship: User 1:N ScanHistory)"},"url":{"type":"string","description":"The URL that was scanned."},"scanDate":{"type":"string","description":"The date and time the URL was scanned.","format":"date-time"},"riskScore":{"type":"number","description":"The risk score assigned to the URL after scanning."},"isMalicious":{"type":"boolean","description":"Indicates whether the scanned URL was identified as malicious."}},"required":["id","userId","url","scanDate","riskScore","isMalicious"]},"CommunityRating":{"$schema":"http://json-schema.org/draft-07/schema#","title":"CommunityRating","type":"object","description":"Represents a community rating for a scanned link.","properties":{"id":{"type":"string","description":"Unique identifier for the CommunityRating entity."},"userId":{"type":"string","description":"Reference to User. (Relationship: User 1:N CommunityRating)"},"scanHistoryId":{"type":"string","description":"Reference to ScanHistory. (Relationship: ScanHistory 1:N CommunityRating)"},"rating":{"type":"number","description":"The rating given by the user for the scanned link (out of 10)."},"comment":{"type":"string","description":"Optional comment provided by the user about the link."}},"required":["id","userId","scanHistoryId","rating"]}},"auth":{"providers":["phone"]},"firestore":{"structure":[{"path":"/users/{userId}","definition":{"entityName":"User","schema":{"$ref":"#/backend/entities/User"},"description":"Stores user profile information. Includes 'isPro' to define pro access status.","params":[{"name":"userId","description":"The unique identifier for the user."}]}},{"path":"/users/{userId}/scanHistory/{scanHistoryId}","definition":{"entityName":"ScanHistory","schema":{"$ref":"#/backend/entities/ScanHistory"},"description":"Stores the scan history for each user.  Path-based ownership ensures simple and efficient security rules.","params":[{"name":"userId","description":"The unique identifier for the user."},{"name":"scanHistoryId","description":"The unique identifier for the scan history entry."}]}},{"path":"/communityRatings/{communityRatingId}","definition":{"entityName":"CommunityRating","schema":{"$ref":"#/backend/entities/CommunityRating"},"description":"Stores community ratings for scanned links. Includes denormalized 'userId' and 'scanHistoryId' for authorization independence.","params":[{"name":"communityRatingId","description":"The unique identifier for the community rating."}]}}],"reasoning":"The Firestore structure is designed to ensure authorization independence, clarity, and scalability. User data and scan history are segregated into separate collections to maintain a homogeneous security posture. User-owned data (scan history) is structured under the `/users/{userId}/scanHistory/{scanHistoryId}` path to simplify ownership-based security rules. Community ratings are stored separately with denormalized `userId` and `scanHistoryId` for efficient querying and to avoid complex `get()` calls in security rules. The `isPro` status is stored directly within the user document to enable easy access and prevent filtering issues. This design supports QAPs by using structural segregation and membership models where appropriate, enabling secure list operations without relying on data-based filtering in rules. Denormalization of authorization fields ensures atomic operations and avoids hierarchical authorization dependencies."}}